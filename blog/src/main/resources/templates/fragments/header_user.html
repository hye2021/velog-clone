<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Header</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <script th:src="@{/js/checkAuth.js}"></script>
</head>
<body>
    <div th:fragment="header">
        <header>
        <div>
            <a th:id = "username"
               th:text="${username}"
               th:href="@{/@{username}}"
               style="color: Black;
               text-decoration: none;
               font-size: 24px;">
            </a>
        </div>
        <nav>
            <div>
                <a href="/">알림</a>
                <a href="/">검색</a>

                <div id="authLinksDiv"></div>

                <script th:src="@{/js/checkAuth.js}"></script>
                <script>
                    // 로그 찍기
                    console.log('header.js');

                    async function isLoggedIn()
                    {
                        const div = document.getElementById('authLinksDiv');
                        const username = document.getElementById('username').textContent;
                        div.innerHTML = '';

                        const auth = await checkAuth();

                        if (auth === username) {
                            console.log('로그인 중');
                            const writeLink = document.createElement('a');
                            writeLink.href = "/write";
                            writeLink.style.color = "Black";
                            writeLink.style.textDecoration = "none";
                            writeLink.textContent = "새 글 작성";

                            const profileLink = document.createElement('a');
                            profileLink.href = "/";
                            const profileImg = document.createElement('img');
                            profileImg.src = "/path/to/profile/image";
                            profileImg.alt = "Profile";
                            profileImg.className = "profile-img";
                            profileLink.appendChild(profileImg);

                            const menuDiv = document.createElement('div');
                            const menuItems = [
                                { href: "/", text: "내 블로그" },
                                { href: "/", text: "임시 글" },
                                { href: "/", text: "읽기 목록" },
                                { href: "/", text: "설정" },
                                { href: "/logout", text: "로그아웃" }
                            ];

                            menuItems.forEach(item => {
                                const a = document.createElement('a');
                                a.href = item.href;
                                a.textContent = item.text;
                                menuDiv.appendChild(a);
                            });

                            div.appendChild(writeLink);
                            div.appendChild(profileLink);
                            div.appendChild(menuDiv);
                        } else {
                            console.log('로그인 안 함');
                            const loginLink = document.createElement('a');
                            loginLink.href = "/loginform";
                            loginLink.style.color = "Black";
                            loginLink.style.textDecoration = "none";
                            loginLink.textContent = "로그인";
                            div.appendChild(loginLink);
                        }
                    }

                    window.onload = isLoggedIn;
                </script>

            </div>
        </nav>
        --------------header--------------
    </header>

</div>

</body>
</html>